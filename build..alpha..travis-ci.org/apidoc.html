<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/smrchy/redis-sessions#readme"

    >redis-sessions (v1.2.0)</a>
</h1>
<h4>An advanced session store for Redis</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.redis-sessions">module redis-sessions</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">redis-sessions.</span>usingDomains</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.redis-sessions">
            function <span class="apidocSignatureSpan"></span>redis-sessions
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.EventEmitter">
            function <span class="apidocSignatureSpan">redis-sessions.</span>EventEmitter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index">
            function <span class="apidocSignatureSpan">redis-sessions.</span>index
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.init">
            function <span class="apidocSignatureSpan">redis-sessions.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.listenerCount">
            function <span class="apidocSignatureSpan">redis-sessions.</span>listenerCount
            <span class="apidocSignatureSpan">(emitter, type)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">redis-sessions.</span>defaultMaxListeners</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">redis-sessions.</span>__super__</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">redis-sessions.</span>index.prototype</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.redis-sessions.index">module redis-sessions.index</a><ol>

        <li>

            <span class="apidocSignatureSpan">boolean <span class="apidocSignatureSpan">redis-sessions.index.</span>usingDomains</span>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.index">
            function <span class="apidocSignatureSpan">redis-sessions.</span>index
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.EventEmitter">
            function <span class="apidocSignatureSpan">redis-sessions.index.</span>EventEmitter
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.init">
            function <span class="apidocSignatureSpan">redis-sessions.index.</span>init
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.listenerCount">
            function <span class="apidocSignatureSpan">redis-sessions.index.</span>listenerCount
            <span class="apidocSignatureSpan">(emitter, type)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">number <span class="apidocSignatureSpan">redis-sessions.index.</span>defaultMaxListeners</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">redis-sessions.index.</span>__super__</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.redis-sessions.index.prototype">module redis-sessions.index.prototype</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._createMultiStatement">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_createMultiStatement
            <span class="apidocSignatureSpan">(app, token, id, ttl)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._createToken">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_createToken
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._handleError">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_handleError
            <span class="apidocSignatureSpan">(cb, err, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._initErrors">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_initErrors
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._kill">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_kill
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._now">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_now
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._prepareSession">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_prepareSession
            <span class="apidocSignatureSpan">(session)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._returnSessions">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_returnSessions
            <span class="apidocSignatureSpan">(options, sessions, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._validate">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_validate
            <span class="apidocSignatureSpan">(o, items, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype._wipe">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_wipe
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.activity">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>activity
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.constructor">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>constructor
            <span class="apidocSignatureSpan">(o)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.create">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>create
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.get">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>get
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.kill">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>kill
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.killall">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>killall
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.killsoid">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>killsoid
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.ping">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>ping
            <span class="apidocSignatureSpan">(cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.quit">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>quit
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.set">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>set
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.soapp">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>soapp
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.redis-sessions.index.prototype.soid">
            function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>soid
            <span class="apidocSignatureSpan">(options, cb)</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>ERRORS</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_VALID</span>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.redis-sessions" id="apidoc.module.redis-sessions">module redis-sessions</a></h1>




    <h2>
        <a href="#apidoc.element.redis-sessions.redis-sessions" id="apidoc.element.redis-sessions.redis-sessions">
        function <span class="apidocSignatureSpan"></span>redis-sessions
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisSessions(o) {
  var ref, ref1, wipe;
  if (o == null) {
    o = {};
  }
  this._wipe = bind(this._wipe, this);
  this._returnSessions = bind(this._returnSessions, this);
  this._initErrors = bind(this._initErrors, this);
  this._handleError = bind(this._handleError, this);
  this.soid = bind(this.soid, this);
  this.soapp = bind(this.soapp, this);
  this.set = bind(this.set, this);
  this.quit = bind(this.quit, this);
  this.ping = bind(this.ping, this);
  this.killsoid = bind(this.killsoid, this);
  this.killall = bind(this.killall, this);
  this._kill = bind(this._kill, this);
  this.kill = bind(this.kill, this);
  this.get = bind(this.get, this);
  this.create = bind(this.create, this);
  this.activity = bind(this.activity, this);
  this._initErrors();
  this.redisns = o.namespace || &#x22;rs&#x22;;
  this.redisns = this.redisns + &#x22;:&#x22;;
  if (((ref = o.client) != null ? (ref1 = ref.constructor) != null ? ref1.name : void 0 : void 0) === &#x22;RedisClient&#x22;) {
    this.redis = o.client;
  } else if (o.options &#x26;&#x26; o.options.url) {
    this.redis = RedisInst.createClient(o.options);
  } else {
    this.redis = RedisInst.createClient(o.port || 6379, o.host || &#x22;127.0.0.1&#x22;, o.options || {});
  }
  this.connected = this.redis.connected || false;
  this.redis.on(&#x22;connect&#x22;, (function(_this) {
    return function() {
      _this.connected = true;
      _this.emit(&#x22;connect&#x22;);
    };
  })(this));
  this.redis.on(&#x22;error&#x22;, (function(_this) {
    return function(err) {
      if (err.message.indexOf(&#x22;ECONNREFUSED&#x22;)) {
        _this.connected = false;
        _this.emit(&#x22;disconnect&#x22;);
      } else {
        console.error(&#x22;Redis ERROR&#x22;, err);
        _this.emit(&#x22;error&#x22;);
      }
    };
  })(this));
  if (o.wipe !== 0) {
    wipe = o.wipe || 600;
    if (wipe &#x3c; 10) {
      wipe = 10;
    }
    setInterval(this._wipe, wipe * 1000);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.EventEmitter" id="apidoc.element.redis-sessions.EventEmitter">
        function <span class="apidocSignatureSpan">redis-sessions.</span>EventEmitter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index" id="apidoc.element.redis-sessions.index">
        function <span class="apidocSignatureSpan">redis-sessions.</span>index
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisSessions(o) {
  var ref, ref1, wipe;
  if (o == null) {
    o = {};
  }
  this._wipe = bind(this._wipe, this);
  this._returnSessions = bind(this._returnSessions, this);
  this._initErrors = bind(this._initErrors, this);
  this._handleError = bind(this._handleError, this);
  this.soid = bind(this.soid, this);
  this.soapp = bind(this.soapp, this);
  this.set = bind(this.set, this);
  this.quit = bind(this.quit, this);
  this.ping = bind(this.ping, this);
  this.killsoid = bind(this.killsoid, this);
  this.killall = bind(this.killall, this);
  this._kill = bind(this._kill, this);
  this.kill = bind(this.kill, this);
  this.get = bind(this.get, this);
  this.create = bind(this.create, this);
  this.activity = bind(this.activity, this);
  this._initErrors();
  this.redisns = o.namespace || &#x22;rs&#x22;;
  this.redisns = this.redisns + &#x22;:&#x22;;
  if (((ref = o.client) != null ? (ref1 = ref.constructor) != null ? ref1.name : void 0 : void 0) === &#x22;RedisClient&#x22;) {
    this.redis = o.client;
  } else if (o.options &#x26;&#x26; o.options.url) {
    this.redis = RedisInst.createClient(o.options);
  } else {
    this.redis = RedisInst.createClient(o.port || 6379, o.host || &#x22;127.0.0.1&#x22;, o.options || {});
  }
  this.connected = this.redis.connected || false;
  this.redis.on(&#x22;connect&#x22;, (function(_this) {
    return function() {
      _this.connected = true;
      _this.emit(&#x22;connect&#x22;);
    };
  })(this));
  this.redis.on(&#x22;error&#x22;, (function(_this) {
    return function(err) {
      if (err.message.indexOf(&#x22;ECONNREFUSED&#x22;)) {
        _this.connected = false;
        _this.emit(&#x22;disconnect&#x22;);
      } else {
        console.error(&#x22;Redis ERROR&#x22;, err);
        _this.emit(&#x22;error&#x22;);
      }
    };
  })(this));
  if (o.wipe !== 0) {
    wipe = o.wipe || 600;
    if (wipe &#x3c; 10) {
      wipe = 10;
    }
    setInterval(this._wipe, wipe * 1000);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.init" id="apidoc.element.redis-sessions.init">
        function <span class="apidocSignatureSpan">redis-sessions.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function () {
  this.domain = null;
  if (EventEmitter.usingDomains) {
    // if there is an active domain, then attach to it.
    domain = domain || require(&#x27;domain&#x27;);
    if (domain.active &#x26;&#x26; !(this instanceof domain.Domain)) {
      this.domain = domain.active;
    }
  }

  if (!this._events || this._events === Object.getPrototypeOf(this)._events) {
    this._events = new EventHandlers();
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.listenerCount" id="apidoc.element.redis-sessions.listenerCount">
        function <span class="apidocSignatureSpan">redis-sessions.</span>listenerCount
        <span class="apidocSignatureSpan">(emitter, type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listenerCount = function (emitter, type) {
  if (typeof emitter.listenerCount === &#x27;function&#x27;) {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>








</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.redis-sessions.index" id="apidoc.module.redis-sessions.index">module redis-sessions.index</a></h1>




    <h2>
        <a href="#apidoc.element.redis-sessions.index.index" id="apidoc.element.redis-sessions.index.index">
        function <span class="apidocSignatureSpan">redis-sessions.</span>index
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisSessions(o) {
  var ref, ref1, wipe;
  if (o == null) {
    o = {};
  }
  this._wipe = bind(this._wipe, this);
  this._returnSessions = bind(this._returnSessions, this);
  this._initErrors = bind(this._initErrors, this);
  this._handleError = bind(this._handleError, this);
  this.soid = bind(this.soid, this);
  this.soapp = bind(this.soapp, this);
  this.set = bind(this.set, this);
  this.quit = bind(this.quit, this);
  this.ping = bind(this.ping, this);
  this.killsoid = bind(this.killsoid, this);
  this.killall = bind(this.killall, this);
  this._kill = bind(this._kill, this);
  this.kill = bind(this.kill, this);
  this.get = bind(this.get, this);
  this.create = bind(this.create, this);
  this.activity = bind(this.activity, this);
  this._initErrors();
  this.redisns = o.namespace || &#x22;rs&#x22;;
  this.redisns = this.redisns + &#x22;:&#x22;;
  if (((ref = o.client) != null ? (ref1 = ref.constructor) != null ? ref1.name : void 0 : void 0) === &#x22;RedisClient&#x22;) {
    this.redis = o.client;
  } else if (o.options &#x26;&#x26; o.options.url) {
    this.redis = RedisInst.createClient(o.options);
  } else {
    this.redis = RedisInst.createClient(o.port || 6379, o.host || &#x22;127.0.0.1&#x22;, o.options || {});
  }
  this.connected = this.redis.connected || false;
  this.redis.on(&#x22;connect&#x22;, (function(_this) {
    return function() {
      _this.connected = true;
      _this.emit(&#x22;connect&#x22;);
    };
  })(this));
  this.redis.on(&#x22;error&#x22;, (function(_this) {
    return function(err) {
      if (err.message.indexOf(&#x22;ECONNREFUSED&#x22;)) {
        _this.connected = false;
        _this.emit(&#x22;disconnect&#x22;);
      } else {
        console.error(&#x22;Redis ERROR&#x22;, err);
        _this.emit(&#x22;error&#x22;);
      }
    };
  })(this));
  if (o.wipe !== 0) {
    wipe = o.wipe || 600;
    if (wipe &#x3c; 10) {
      wipe = 10;
    }
    setInterval(this._wipe, wipe * 1000);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.EventEmitter" id="apidoc.element.redis-sessions.index.EventEmitter">
        function <span class="apidocSignatureSpan">redis-sessions.index.</span>EventEmitter
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function EventEmitter() {
  EventEmitter.init.call(this);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.init" id="apidoc.element.redis-sessions.index.init">
        function <span class="apidocSignatureSpan">redis-sessions.index.</span>init
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function () {
  this.domain = null;
  if (EventEmitter.usingDomains) {
    // if there is an active domain, then attach to it.
    domain = domain || require(&#x27;domain&#x27;);
    if (domain.active &#x26;&#x26; !(this instanceof domain.Domain)) {
      this.domain = domain.active;
    }
  }

  if (!this._events || this._events === Object.getPrototypeOf(this)._events) {
    this._events = new EventHandlers();
    this._eventsCount = 0;
  }

  this._maxListeners = this._maxListeners || undefined;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.listenerCount" id="apidoc.element.redis-sessions.index.listenerCount">
        function <span class="apidocSignatureSpan">redis-sessions.index.</span>listenerCount
        <span class="apidocSignatureSpan">(emitter, type)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">listenerCount = function (emitter, type) {
  if (typeof emitter.listenerCount === &#x27;function&#x27;) {
    return emitter.listenerCount(type);
  } else {
    return listenerCount.call(emitter, type);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.redis-sessions.index.prototype" id="apidoc.module.redis-sessions.index.prototype">module redis-sessions.index.prototype</a></h1>


    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._createMultiStatement" id="apidoc.element.redis-sessions.index.prototype._createMultiStatement">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_createMultiStatement
        <span class="apidocSignatureSpan">(app, token, id, ttl)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createMultiStatement = function (app, token, id, ttl) {
  var now;
  now = this._now();
  return [[&#x22;zadd&#x22;, &#x22;&#x22; + this.redisns + app + &#x22;:_sessions&#x22;, now, token + &#x22;:&#x22; + id], [&#x22;zadd&#x22;, &#x22;&#x22; + this.redisns + app + &#x22;:_users&#x22;,
now, id], [&#x22;zadd&#x22;, this.redisns + &#x22;SESSIONS&#x22;, now + ttl, app + &#x22;:&#x22; + token + &#x22;:&#x22; + id]];
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  ___duMmYkEy: null
};
options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;, &#x22;ip&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;], cb);
if (options === false) {
  return;
}
token = this._createToken();
mc = this.<span class="apidocCodeKeywordSpan">_createMultiStatement</span>(options.app, token, options.id, options.ttl);
mc.push([&#x22;sadd&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + options.id, token]);
thesession = [&#x22;hmset&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + token, &#x22;id&#x22;, options.id, &#
x22;r&#x22;, 1, &#x22;w&#x22;, 1, &#x22;ip&#x22;, options.ip, &#x22;la&#x22;, this._now(), &#x22;ttl&#x22;, parseInt(options.ttl
)];
if (options.d) {
  nullkeys = [];
  for (e in options.d) {
    if (options.d[e] === null) {
      nullkeys.push(e);
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._createToken" id="apidoc.element.redis-sessions.index.prototype._createToken">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_createToken
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_createToken = function () {
  var i, j, possible, t;
  t = &#x22;&#x22;;
  possible = &#x22;ABCDEFGHIJKLMNOPQRSTUVWXYabcdefghijklmnopqrstuvwxyz0123456789&#x22;;
  for (i = j = 0; j &#x3c; 55; i = ++j) {
    t += possible.charAt(Math.floor(Math.random() * possible.length));
  }
  return t + &#x27;Z&#x27; + new Date().getTime().toString(36);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
options.d = options.d || {
  ___duMmYkEy: null
};
options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;, &#x22;ip&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;], cb);
if (options === false) {
  return;
}
token = this.<span class="apidocCodeKeywordSpan">_createToken</span>();
mc = this._createMultiStatement(options.app, token, options.id, options.ttl);
mc.push([&#x22;sadd&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + options.id, token]);
thesession = [&#x22;hmset&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + token, &#x22;id&#x22;, options.id, &#
x22;r&#x22;, 1, &#x22;w&#x22;, 1, &#x22;ip&#x22;, options.ip, &#x22;la&#x22;, this._now(), &#x22;ttl&#x22;, parseInt(options.ttl
)];
if (options.d) {
  nullkeys = [];
  for (e in options.d) {
    if (options.d[e] === null) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._handleError" id="apidoc.element.redis-sessions.index.prototype._handleError">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_handleError
        <span class="apidocSignatureSpan">(cb, err, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_handleError = function (cb, err, data) {
  var _err, ref;
  if (data == null) {
    data = {};
  }
  if (_.isString(err)) {
    _err = new Error();
    _err.name = err;
    _err.message = ((ref = this._ERRORS) != null ? typeof ref[err] === &#x22;function&#x22; ? ref[err](data) : void 0 : void 0) || &#x22;unkown
&#x22;;
  } else {
    _err = err;
  }
  cb(_err);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
item = items[j];
switch (item) {
  case &#x22;app&#x22;:
  case &#x22;id&#x22;:
  case &#x22;ip&#x22;:
  case &#x22;token&#x22;:
    if (!o[item]) {
      this.<span class="apidocCodeKeywordSpan">_handleError</span>(cb, &#x22;missingParameter&#x22;, {
        item: item
      });
      return false;
    }
    o[item] = o[item].toString();
    if (!this._VALID[item].test(o[item])) {
      this._handleError(cb, &#x22;invalidFormat&#x22;, {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._initErrors" id="apidoc.element.redis-sessions.index.prototype._initErrors">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_initErrors
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_initErrors = function () {
  var key, msg, ref;
  this._ERRORS = {};
  ref = this.ERRORS;
  for (key in ref) {
    msg = ref[key];
    this._ERRORS[key] = _.template(msg);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
this.killsoid = bind(this.killsoid, this);
this.killall = bind(this.killall, this);
this._kill = bind(this._kill, this);
this.kill = bind(this.kill, this);
this.get = bind(this.get, this);
this.create = bind(this.create, this);
this.activity = bind(this.activity, this);
this.<span class="apidocCodeKeywordSpan">_initErrors</span>();
this.redisns = o.namespace || &#x22;rs&#x22;;
this.redisns = this.redisns + &#x22;:&#x22;;
if (((ref = o.client) != null ? (ref1 = ref.constructor) != null ? ref1.name : void 0 : void 0) === &#x22;RedisClient&#x22;) {
  this.redis = o.client;
} else if (o.options &#x26;&#x26; o.options.url) {
  this.redis = RedisInst.createClient(o.options);
} else {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._kill" id="apidoc.element.redis-sessions.index.prototype._kill">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_kill
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_kill = function (options, cb) {
  var mc;
  mc = [[&#x22;zrem&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:_sessions&#x22;, options.token + &#x22;:&#x22; + options.id], [&#x22;srem&#x22;, &#x22;&#x22; + this.redisns +
options.app + &#x22;:us:&#x22; + options.id, options.token], [&#x22;zrem&#x22;, this.redisns + &#x22;SESSIONS&#x22;, options.app + &#x22;:&#x22; + options.token + &#x22;:&#x22; +
options.id], [&#x22;del&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + options.token], [&#x22;exists&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; +
options.id]];
  this.redis.multi(mc).exec((function(_this) {
    return function(err, resp) {
      if (err) {
        cb(err);
        return;
      }
      if (resp[4] === 0) {
        _this.redis.zrem(&#x22;&#x22; + _this.redisns + options.app + &#x22;:_users&#x22;, options.id, function() {
          if (err) {
            cb(err);
            return;
          }
          cb(null, {
            kill: resp[3]
          });
        });
      } else {
        cb(null, {
          kill: resp[3]
        });
      }
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
			if not err and resp.length
				_.each resp, (e) -&#x3e;
					e = e.split(&#x27;:&#x27;)
					options =
						app: e[0]
						token: e[1]
						id: e[2]
					that.<span class="apidocCodeKeywordSpan">_kill</span>(options, -&#x3e;)
					return
				return
			return
		return

	ERRORS:
		&#x22;missingParameter&#x22;: &#x22;No &#x3c;%= item %&#x3e; supplied&#x22;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._now" id="apidoc.element.redis-sessions.index.prototype._now">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_now
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_now = function () {
  return parseInt((new Date()).getTime() / 1000);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }
}

RedisSessions.prototype.activity = function(options, cb) {
  if (this._validate(options, [&#x22;app&#x22;, &#x22;dt&#x22;], cb) === false) {
    return;
  }
  this.redis.zcount(&#x22;&#x22; + this.redisns + options.app + &#x22;:_users&#x22;, this.<span class="apidocCodeKeywordSpan">_now
</span>() - options.dt, &#x22;+inf&#x22;, function(err, resp) {
    if (err) {
      cb(err);
      return;
    }
    cb(null, {
      activity: resp
    });
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._prepareSession" id="apidoc.element.redis-sessions.index.prototype._prepareSession">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_prepareSession
        <span class="apidocSignatureSpan">(session)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_prepareSession = function (session) {
  var now, o;
  now = this._now();
  if (session[0] === null) {
    return null;
  }
  o = {
    id: session[0],
    r: Number(session[1]),
    w: Number(session[2]),
    ttl: Number(session[3]),
    idle: now - session[5],
    ip: session[6]
  };
  if (o.ttl &#x3c; o.idle) {
    return null;
  }
  if (session[4]) {
    o.d = JSON.parse(session[4]);
  }
  return o;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
    this.redis.hmget(thekey, &#x22;id&#x22;, &#x22;r&#x22;, &#x22;w&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;, &#x22;la&#x22;, &#x22
;ip&#x22;, (function(_this) {
return function(err, resp) {
  var mc, o;
  if (err) {
    cb(err);
    return;
  }
  o = _this.<span class="apidocCodeKeywordSpan">_prepareSession</span>(resp);
  if (o === null) {
    cb(null, {});
    return;
  }
  if (options._noupdate) {
    cb(null, o);
    return;
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._returnSessions" id="apidoc.element.redis-sessions.index.prototype._returnSessions">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_returnSessions
        <span class="apidocSignatureSpan">(options, sessions, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_returnSessions = function (options, sessions, cb) {
  var e, mc;
  if (!sessions.length) {
    cb(null, {
      sessions: []
    });
    return;
  }
  mc = (function() {
    var j, len, results;
    results = [];
    for (j = 0, len = sessions.length; j &#x3c; len; j++) {
      e = sessions[j];
      results.push([&#x22;hmget&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + e, &#x22;id&#x22;, &#x22;r&#x22;, &#x22;w&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;, &#x22;la&#x22;, &#x22;ip&#x22;]);
    }
    return results;
  }).call(this);
  this.redis.multi(mc).exec((function(_this) {
    return function(err, resp) {
      var j, len, o, session;
      if (err) {
        cb(err);
        return;
      }
      o = [];
      for (j = 0, len = resp.length; j &#x3c; len; j++) {
        e = resp[j];
        session = _this._prepareSession(e);
        if (session !== null) {
          o.push(session);
        }
      }
      cb(null, {
        sessions: o
      });
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        results = [];
        for (j = 0, len = resp.length; j &#x3c; len; j++) {
          e = resp[j];
          results.push(e.split(&#x27;:&#x27;)[0]);
        }
        return results;
      })();
      _this.<span class="apidocCodeKeywordSpan">_returnSessions</span>(options, resp, cb);
    };
  })(this));
};

RedisSessions.prototype.soid = function(options, cb) {
  options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;], cb);
  if (options === false) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._validate" id="apidoc.element.redis-sessions.index.prototype._validate">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_validate
        <span class="apidocSignatureSpan">(o, items, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_validate = function (o, items, cb) {
  var e, item, j, keys, len;
  for (j = 0, len = items.length; j &#x3c; len; j++) {
    item = items[j];
    switch (item) {
      case &#x22;app&#x22;:
      case &#x22;id&#x22;:
      case &#x22;ip&#x22;:
      case &#x22;token&#x22;:
        if (!o[item]) {
          this._handleError(cb, &#x22;missingParameter&#x22;, {
            item: item
          });
          return false;
        }
        o[item] = o[item].toString();
        if (!this._VALID[item].test(o[item])) {
          this._handleError(cb, &#x22;invalidFormat&#x22;, {
            item: item
          });
          return false;
        }
        break;
      case &#x22;ttl&#x22;:
        o.ttl = parseInt(o.ttl || 7200, 10);
        if (_.isNaN(o.ttl) || !_.isNumber(o.ttl) || o.ttl &#x3c; 10) {
          this._handleError(cb, &#x22;invalidValue&#x22;, {
            msg: &#x22;ttl must be a positive integer &#x3e;= 10&#x22;
          });
          return false;
        }
        break;
      case &#x22;dt&#x22;:
        o[item] = parseInt(o[item], 10);
        if (_.isNaN(o[item]) || !_.isNumber(o[item]) || o[item] &#x3c; 10) {
          this._handleError(cb, &#x22;invalidValue&#x22;, {
            msg: &#x22;ttl must be a positive integer &#x3e;= 10&#x22;
          });
          return false;
        }
        break;
      case &#x22;d&#x22;:
        if (!o[item]) {
          this._handleError(cb, &#x22;missingParameter&#x22;, {
            item: item
          });
          return false;
        }
        if (!_.isObject(o.d) || _.isArray(o.d)) {
          this._handleError(cb, &#x22;invalidValue&#x22;, {
            msg: &#x22;d must be an object&#x22;
          });
          return false;
        }
        keys = _.keys(o.d);
        if (!keys.length) {
          this._handleError(cb, &#x22;invalidValue&#x22;, {
            msg: &#x22;d must containt at least one key.&#x22;
          });
          return false;
        }
        for (e in o.d) {
          if (!_.isString(o.d[e]) &#x26;&#x26; !_.isNumber(o.d[e]) &#x26;&#x26; !_.isBoolean(o.d[e]) &#x26;&#x26; !_.isNull(o.d[e])) {
            this._handleError(cb, &#x22;invalidValue&#x22;, {
              msg: &#x22;d.&#x22; + e + &#x22; has a forbidden type. Only strings, numbers, boolean and null are allowed.&#x22;
            });
            return false;
          }
        }
    }
  }
  return o;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
      wipe = 10;
    }
    setInterval(this._wipe, wipe * 1000);
  }
}

RedisSessions.prototype.activity = function(options, cb) {
  if (this.<span class="apidocCodeKeywordSpan">_validate</span>(options, [&#x22;app&#x22;, &#x22;dt&#x22;], cb) === false) {
    return;
  }
  this.redis.zcount(&#x22;&#x22; + this.redisns + options.app + &#x22;:_users&#x22;, this._now() - options.dt, &#x22;+inf&#x22;,
function(err, resp) {
    if (err) {
      cb(err);
      return;
    }
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype._wipe" id="apidoc.element.redis-sessions.index.prototype._wipe">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>_wipe
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">_wipe = function () {
  var that;
  that = this;
  this.redis.zrangebyscore(this.redisns + &#x22;SESSIONS&#x22;, &#x22;-inf&#x22;, this._now(), function(err, resp) {
    if (!err &#x26;&#x26; resp.length) {
      _.each(resp, function(e) {
        var options;
        e = e.split(&#x27;:&#x27;);
        options = {
          app: e[0],
          token: e[1],
          id: e[2]
        };
        that._kill(options, function() {});
      });
      return;
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.activity" id="apidoc.element.redis-sessions.index.prototype.activity">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>activity
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">activity = function (options, cb) {
  if (this._validate(options, [&#x22;app&#x22;, &#x22;dt&#x22;], cb) === false) {
    return;
  }
  this.redis.zcount(&#x22;&#x22; + this.redisns + options.app + &#x22;:_users&#x22;, this._now() - options.dt, &#x22;+inf&#x22;, function(err, resp) {
    if (err) {
      cb(err);
      return;
    }
    cb(null, {
      activity: resp
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
### Activity

Query the amount of active session within the last 10 minutes (600 seconds).
Note: Multiple sessions from the same user id will be counted as one.

```javascript

rs.<span class="apidocCodeKeywordSpan">activity</span>({
  app: rsapp,
  dt: 600},
  function(err, resp) {
/*
resp contains the activity:

{activity: 12}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.constructor" id="apidoc.element.redis-sessions.index.prototype.constructor">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>constructor
        <span class="apidocSignatureSpan">(o)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function RedisSessions(o) {
  var ref, ref1, wipe;
  if (o == null) {
    o = {};
  }
  this._wipe = bind(this._wipe, this);
  this._returnSessions = bind(this._returnSessions, this);
  this._initErrors = bind(this._initErrors, this);
  this._handleError = bind(this._handleError, this);
  this.soid = bind(this.soid, this);
  this.soapp = bind(this.soapp, this);
  this.set = bind(this.set, this);
  this.quit = bind(this.quit, this);
  this.ping = bind(this.ping, this);
  this.killsoid = bind(this.killsoid, this);
  this.killall = bind(this.killall, this);
  this._kill = bind(this._kill, this);
  this.kill = bind(this.kill, this);
  this.get = bind(this.get, this);
  this.create = bind(this.create, this);
  this.activity = bind(this.activity, this);
  this._initErrors();
  this.redisns = o.namespace || &#x22;rs&#x22;;
  this.redisns = this.redisns + &#x22;:&#x22;;
  if (((ref = o.client) != null ? (ref1 = ref.constructor) != null ? ref1.name : void 0 : void 0) === &#x22;RedisClient&#x22;) {
    this.redis = o.client;
  } else if (o.options &#x26;&#x26; o.options.url) {
    this.redis = RedisInst.createClient(o.options);
  } else {
    this.redis = RedisInst.createClient(o.port || 6379, o.host || &#x22;127.0.0.1&#x22;, o.options || {});
  }
  this.connected = this.redis.connected || false;
  this.redis.on(&#x22;connect&#x22;, (function(_this) {
    return function() {
      _this.connected = true;
      _this.emit(&#x22;connect&#x22;);
    };
  })(this));
  this.redis.on(&#x22;error&#x22;, (function(_this) {
    return function(err) {
      if (err.message.indexOf(&#x22;ECONNREFUSED&#x22;)) {
        _this.connected = false;
        _this.emit(&#x22;disconnect&#x22;);
      } else {
        console.error(&#x22;Redis ERROR&#x22;, err);
        _this.emit(&#x22;error&#x22;);
      }
    };
  })(this));
  if (o.wipe !== 0) {
    wipe = o.wipe || 600;
    if (wipe &#x3c; 10) {
      wipe = 10;
    }
    setInterval(this._wipe, wipe * 1000);
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.create" id="apidoc.element.redis-sessions.index.prototype.create">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>create
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">create = function (options, cb) {
  var e, mc, nullkeys, thesession, token;
  options.d = options.d || {
    ___duMmYkEy: null
  };
  options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;, &#x22;ip&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;], cb);
  if (options === false) {
    return;
  }
  token = this._createToken();
  mc = this._createMultiStatement(options.app, token, options.id, options.ttl);
  mc.push([&#x22;sadd&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + options.id, token]);
  thesession = [&#x22;hmset&#x22;, &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + token, &#x22;id&#x22;, options.id, &#x22;r&#x22;, 1, &#x22;w&#x22;, 1, &#x22;ip&#x22;, options.ip, &#x22;la&#x22;,
this._now(), &#x22;ttl&#x22;, parseInt(options.ttl)];
  if (options.d) {
    nullkeys = [];
    for (e in options.d) {
      if (options.d[e] === null) {
        nullkeys.push(e);
      }
    }
    options.d = _.omit(options.d, nullkeys);
    if (_.keys(options.d).length) {
      thesession = thesession.concat([&#x22;d&#x22;, JSON.stringify(options.d)]);
    }
  }
  mc.push(thesession);
  this.redis.multi(mc).exec(function(err, resp) {
    if (err) {
      cb(err);
      return;
    }
    if (resp[4] !== &#x22;OK&#x22;) {
      cb(&#x22;Unknow error&#x22;);
      return;
    }
    cb(null, {
      token: token
    });
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* `ttl` (Number) *optional* The &#x22;Time-To-Live&#x22; for the session in seconds. Default: 7200.
* `d` (Object) *optional* Additional data to set for this sessions. (see the &#x22;set&#x22; method)

```javascript

// Set a session for `user1001`

rs.<span class="apidocCodeKeywordSpan">create</span>({
app: rsapp,
id: &#x22;user1001&#x22;,
ip: &#x22;192.168.22.58&#x22;,
ttl: 3600,
d: {
  foo: &#x22;bar&#x22;,
  unread_msgs: 34
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.get" id="apidoc.element.redis-sessions.index.prototype.get">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>get
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">get = function (options, cb) {
  var now, thekey;
  options = this._validate(options, [&#x22;app&#x22;, &#x22;token&#x22;], cb);
  if (options === false) {
    return;
  }
  now = this._now();
  thekey = &#x22;&#x22; + this.redisns + options.app + &#x22;:&#x22; + options.token;
  this.redis.hmget(thekey, &#x22;id&#x22;, &#x22;r&#x22;, &#x22;w&#x22;, &#x22;ttl&#x22;, &#x22;d&#x22;, &#x22;la&#x22;, &#x22;ip&#x22;, (function(_this) {
    return function(err, resp) {
      var mc, o;
      if (err) {
        cb(err);
        return;
      }
      o = _this._prepareSession(resp);
      if (o === null) {
        cb(null, {});
        return;
      }
      if (options._noupdate) {
        cb(null, o);
        return;
      }
      mc = _this._createMultiStatement(options.app, options.token, o.id, o.ttl);
      mc.push([&#x22;hincrby&#x22;, thekey, &#x22;r&#x22;, 1]);
      if (o.idle &#x3e; 1) {
        mc.push([&#x22;hset&#x22;, thekey, &#x22;la&#x22;, now]);
      }
      _this.redis.multi(mc).exec(function(err, resp) {
        if (err) {
          cb(err);
          return;
        }
        cb(null, o);
      });
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

  RedisSessions.prototype.kill = function(options, cb) {
options = this._validate(options, [&#x22;app&#x22;, &#x22;token&#x22;], cb);
if (options === false) {
  return;
}
options._noupdate = true;
this.<span class="apidocCodeKeywordSpan">get</span>(options, (function(_this) {
  return function(err, resp) {
    if (err) {
      cb(err);
      return;
    }
    if (!resp.id) {
      cb(null, {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.kill" id="apidoc.element.redis-sessions.index.prototype.kill">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>kill
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">kill = function (options, cb) {
  options = this._validate(options, [&#x22;app&#x22;, &#x22;token&#x22;], cb);
  if (options === false) {
    return;
  }
  options._noupdate = true;
  this.get(options, (function(_this) {
    return function(err, resp) {
      if (err) {
        cb(err);
        return;
      }
      if (!resp.id) {
        cb(null, {
          kill: 0
        });
        return;
      }
      options.id = resp.id;
      _this._kill(options, cb);
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### Kill

Kill a single session by supplying app and token:

```javascript

rs.<span class="apidocCodeKeywordSpan">kill</span>({
  app: rsapp,
  token: &#x22;r30kKwv3sA6ExrJ9OmLSm4Wo3nt9MQA1yG94wn6ByFbNrVWhcwAyOM7Zhfxqh8fe&#x22;},
  function(err, resp) {
/*
resp contains the result:

{kill: 1}
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.killall" id="apidoc.element.redis-sessions.index.prototype.killall">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>killall
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">killall = function (options, cb) {
  var appsessionkey, appuserkey;
  options = this._validate(options, [&#x22;app&#x22;], cb);
  if (options === false) {
    return;
  }
  appsessionkey = &#x22;&#x22; + this.redisns + options.app + &#x22;:_sessions&#x22;;
  appuserkey = &#x22;&#x22; + this.redisns + options.app + &#x22;:_users&#x22;;
  this.redis.zrange(appsessionkey, 0, -1, (function(_this) {
    return function(err, resp) {
      var e, globalkeys, j, len, mc, thekey, tokenkeys, userkeys, ussets;
      if (err) {
        cb(err);
        return;
      }
      if (!resp.length) {
        cb(null, {
          kill: 0
        });
        return;
      }
      globalkeys = [];
      tokenkeys = [];
      userkeys = [];
      for (j = 0, len = resp.length; j &#x3c; len; j++) {
        e = resp[j];
        thekey = e.split(&#x22;:&#x22;);
        globalkeys.push(options.app + &#x22;:&#x22; + e);
        tokenkeys.push(&#x22;&#x22; + _this.redisns + options.app + &#x22;:&#x22; + thekey[0]);
        userkeys.push(thekey[1]);
      }
      userkeys = _.uniq(userkeys);
      ussets = (function() {
        var k, len1, results;
        results = [];
        for (k = 0, len1 = userkeys.length; k &#x3c; len1; k++) {
          e = userkeys[k];
          results.push(&#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + e);
        }
        return results;
      }).call(_this);
      mc = [[&#x22;zrem&#x22;, appsessionkey].concat(resp), [&#x22;zrem&#x22;, appuserkey].concat(userkeys), [&#x22;zrem&#x22;, _this.redisns + &#x22;SESSIONS&#x22;].concat
(globalkeys), [&#x22;del&#x22;].concat(ussets), [&#x22;del&#x22;].concat(tokenkeys)];
      _this.redis.multi(mc).exec(function(err, resp) {
        if (err) {
          cb(err);
          return;
        }
        cb(null, {
          kill: resp[0]
        });
      });
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### Killall

Kill all sessions of an app:

```javascript

rs.<span class="apidocCodeKeywordSpan">killall</span>({app: rsapp},
function(err, resp) {
  /*
  resp contains the result:

  {kill: 12} // The amount of sessions that were killed
  */
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.killsoid" id="apidoc.element.redis-sessions.index.prototype.killsoid">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>killsoid
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">killsoid = function (options, cb) {
  options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;], cb);
  if (options === false) {
    return;
  }
  this.redis.smembers(&#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + options.id, (function(_this) {
    return function(err, resp) {
      var j, len, mc, token;
      if (err) {
        cb(err);
        return;
      }
      if (!resp.length) {
        cb(null, {
          kill: 0
        });
        return;
      }
      mc = [];
      for (j = 0, len = resp.length; j &#x3c; len; j++) {
        token = resp[j];
        mc.push([&#x22;zrem&#x22;, &#x22;&#x22; + _this.redisns + options.app + &#x22;:_sessions&#x22;, token + &#x22;:&#x22; + options.id]);
        mc.push([&#x22;srem&#x22;, &#x22;&#x22; + _this.redisns + options.app + &#x22;:us:&#x22; + options.id, token]);
        mc.push([&#x22;zrem&#x22;, _this.redisns + &#x22;SESSIONS&#x22;, options.app + &#x22;:&#x22; + token + &#x22;:&#x22; + options.id]);
        mc.push([&#x22;del&#x22;, &#x22;&#x22; + _this.redisns + options.app + &#x22;:&#x22; + token]);
      }
      mc.push([&#x22;exists&#x22;, &#x22;&#x22; + _this.redisns + options.app + &#x22;:us:&#x22; + options.id]);
      _this.redis.multi(mc).exec(function(err, resp) {
        var e, k, len1, ref, total;
        if (err) {
          cb(err);
          return;
        }
        total = 0;
        ref = resp.slice(3);
        for (k = 0, len1 = ref.length; k &#x3c; len1; k += 4) {
          e = ref[k];
          total = total + e;
        }
        if (_.last(resp) === 0) {
          _this.redis.zrem(&#x22;&#x22; + _this.redisns + options.app + &#x22;:_users&#x22;, options.id, function() {
            cb(null, {
              kill: total
            });
          });
        } else {
          cb(null, {
            kill: total
          });
        }
      });
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### Kill all sessions of an id

Kill all sessions of an id within an app:

```javascript

rs.<span class="apidocCodeKeywordSpan">killsoid</span>({app: rsapp, id: &#x27;bulkuser_999&#x27;},
function(err, resp) {
  /*
  resp contains the result:

  {kill: 2} // The amount of sessions that were killed
  */
});
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.ping" id="apidoc.element.redis-sessions.index.prototype.ping">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>ping
        <span class="apidocSignatureSpan">(cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">ping = function (cb) {
  this.redis.ping(cb);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
        }
      });
    };
  })(this));
};

RedisSessions.prototype.ping = function(cb) {
  this.redis.<span class="apidocCodeKeywordSpan">ping</span>(cb);
};

RedisSessions.prototype.quit = function() {
  this.redis.quit();
};

RedisSessions.prototype.set = function(options, cb) {
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.quit" id="apidoc.element.redis-sessions.index.prototype.quit">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>quit
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">quit = function () {
  this.redis.quit();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
		return

	# ## Quit
	#
	# Quit the Redis connection
	# This is needed if Redis-Session is used with AWS Lambda.
	quit: () =&#x3e;
		@redis.<span class="apidocCodeKeywordSpan">quit</span>()
		return


	# ## Set
	#
	# Set/Update/Delete custom data for a single session.
	# All custom data is stored in the `d` object which is a simple hash object structure.
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.set" id="apidoc.element.redis-sessions.index.prototype.set">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>set
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">set = function (options, cb) {
  options = this._validate(options, [&#x22;app&#x22;, &#x22;token&#x22;, &#x22;d&#x22;], cb);
  if (options === false) {
    return;
  }
  options._noupdate = true;
  this.get(options, (function(_this) {
    return function(err, resp) {
      var e, mc, nullkeys, thekey;
      if (err) {
        cb(err);
        return;
      }
      if (!resp.id) {
        cb(null, {});
        return;
      }
      nullkeys = [];
      for (e in options.d) {
        if (options.d[e] === null) {
          nullkeys.push(e);
        }
      }
      if (resp.d) {
        resp.d = _.extend(_.omit(resp.d, nullkeys), _.omit(options.d, nullkeys));
      } else {
        resp.d = _.omit(options.d, nullkeys);
      }
      thekey = &#x22;&#x22; + _this.redisns + options.app + &#x22;:&#x22; + options.token;
      mc = _this._createMultiStatement(options.app, options.token, resp.id, resp.ttl);
      mc.push([&#x22;hincrby&#x22;, thekey, &#x22;w&#x22;, 1]);
      if (resp.idle &#x3e; 1) {
        mc.push([&#x22;hset&#x22;, thekey, &#x22;la&#x22;, _this._now()]);
      }
      if (_.keys(resp.d).length) {
        mc.push([&#x22;hset&#x22;, thekey, &#x22;d&#x22;, JSON.stringify(resp.d)]);
      } else {
        mc.push([&#x22;hdel&#x22;, thekey, &#x22;d&#x22;]);
        resp = _.omit(resp, &#x22;d&#x22;);
      }
      _this.redis.multi(mc).exec(function(err, reply) {
        if (err) {
          cb(err);
          return;
        }
        resp.w = reply[3];
        cb(null, resp);
      });
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
* As long as the `ttl` isn&#x27;t reached this token can be used to get the session object for this user.
* Remember that a user (`user1001` in this case) might have other sessions.
* If you want to limit the number of sessions a user might have you can use the `soid` (sessions of id) method to find other sessions
 of this user or the `killsoid` (Kill sessions of id) method to kill his other sessions first.

### Update and add some more data to an existing session

```javascript
rs.<span class="apidocCodeKeywordSpan">set</span>({
app: rsapp,
token: &#x22;r30kKwv3sA6ExrJ9OmLSm4Wo3nt9MQA1yG94wn6ByFbNrVWhcwAyOM7Zhfxqh8fe&#x22;,
d: {
  &#x22;unread_msgs&#x22;: 12,
  &#x22;last_action&#x22;: &#x22;/read/news&#x22;,
  &#x22;birthday&#x22;: &#x22;2013-08-13&#x22;
}},
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.soapp" id="apidoc.element.redis-sessions.index.prototype.soapp">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>soapp
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">soapp = function (options, cb) {
  if (this._validate(options, [&#x22;app&#x22;, &#x22;dt&#x22;], cb) === false) {
    return;
  }
  this.redis.zrevrangebyscore(&#x22;&#x22; + this.redisns + options.app + &#x22;:_sessions&#x22;, &#x22;+inf&#x22;, this._now() - options.dt, (function(_this) {
    return function(err, resp) {
      var e;
      if (err) {
        cb(err);
        return;
      }
      resp = (function() {
        var j, len, results;
        results = [];
        for (j = 0, len = resp.length; j &#x3c; len; j++) {
          e = resp[j];
          results.push(e.split(&#x27;:&#x27;)[0]);
        }
        return results;
      })();
      _this._returnSessions(options, resp, cb);
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### Sessions of App

Get all sessions of an app there were active within the last 10 minutes (600 seconds).

```javascript

rs.<span class="apidocCodeKeywordSpan">soapp</span>({
  app: rsapp,
  dt: 600},
  function(err, resp) {
/*
resp contains the sessions:

{ sessions:
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.redis-sessions.index.prototype.soid" id="apidoc.element.redis-sessions.index.prototype.soid">
        function <span class="apidocSignatureSpan">redis-sessions.index.prototype.</span>soid
        <span class="apidocSignatureSpan">(options, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">soid = function (options, cb) {
  options = this._validate(options, [&#x22;app&#x22;, &#x22;id&#x22;], cb);
  if (options === false) {
    return;
  }
  this.redis.smembers(&#x22;&#x22; + this.redisns + options.app + &#x22;:us:&#x22; + options.id, (function(_this) {
    return function(err, resp) {
      if (err) {
        cb(err);
        return;
      }
      _this._returnSessions(options, resp, cb);
    };
  })(this));
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

### Sessions of Id

Get all sessions within an app that belong to a single id. This would be all sessions of a single user in case he is logged in on
 different browsers / devices.

```javascript

rs.<span class="apidocCodeKeywordSpan">soid</span>({
  app: rsapp,
  id: &#x22;bulkuser_999&#x22;},
  function(err, resp) {
/*
resp contains the sessions:

{ sessions:
...</pre></li>
    </ul>






</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
